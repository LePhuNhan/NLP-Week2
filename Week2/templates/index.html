<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• Ph√¢n t√≠ch VƒÉn b·∫£n NLP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-brain"></i> C√¥ng c·ª• Ph√¢n t√≠ch VƒÉn b·∫£n NLP</h1>
            <p>Ph√¢n t√≠ch vƒÉn b·∫£n v·ªõi Tokenization, POS Tagging v√† Named Entity Recognition</p>
            <p class="language-support"><i class="fas fa-globe"></i> H·ªó tr·ª£: Ti·∫øng Vi·ªát üáªüá≥ | English üá∫üá∏</p>
        </header>

        <main class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="textInput">Nh·∫≠p vƒÉn b·∫£n c·∫ßn ph√¢n t√≠ch:</label>
                    <textarea 
                        id="textInput" 
                        placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Vi·ªát ho·∫∑c ti·∫øng Anh c·ªßa b·∫°n ·ªü ƒë√¢y...&#10;&#10;V√≠ d·ª• ti·∫øng Vi·ªát: C√¥ng ty Apple Inc. c√≥ tr·ª• s·ªü t·∫°i Cupertino, California. Tim Cook l√† CEO c·ªßa c√¥ng ty.&#10;V√≠ d·ª• ti·∫øng Anh: Apple Inc. is located in Cupertino, California. Tim Cook is the CEO."
                        rows="6"
                    ></textarea>
                </div>
                <button id="analyzeBtn" class="analyze-btn">
                    <i class="fas fa-search"></i> Ph√¢n t√≠ch vƒÉn b·∫£n
                </button>
            </div>

            <div id="loadingIndicator" class="loading hidden">
                <i class="fas fa-spinner fa-spin"></i>
                <span>ƒêang ph√¢n t√≠ch vƒÉn b·∫£n...</span>
            </div>

            <div id="results" class="results hidden">
                <div class="result-section language-info">
                    <h2><i class="fas fa-language"></i> Th√¥ng tin Ng√¥n ng·ªØ</h2>
                    <div id="languageInfo" class="language-info-content"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-list"></i> Danh s√°ch Token</h2>
                    <div id="tokensList" class="token-list"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-tags"></i> POS Tags</h2>
                    <div id="posTags" class="pos-tags"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-code"></i> Ph√¢n t√≠ch Chi ti·∫øt</h2>
                    <div id="spacyAnalysis" class="spacy-analysis"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-map-marker-alt"></i> Named Entity Recognition</h2>
                    <div id="entitiesList" class="entities-list"></div>
                </div>
            </div>

            <div id="errorMessage" class="error-message hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText"></span>
            </div>
        </main>

        <footer class="footer">
            <p>ƒê∆∞·ª£c x√¢y d·ª±ng v·ªõi Flask, NLTK v√† spaCy</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const textInput = document.getElementById('textInput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const results = document.getElementById('results');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            analyzeBtn.addEventListener('click', analyzeText);

            textInput.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    analyzeText();
                }
            });

            async function analyzeText() {
                const text = textInput.value.trim();
                
                if (!text) {
                    showError('Vui l√≤ng nh·∫≠p vƒÉn b·∫£n ƒë·ªÉ ph√¢n t√≠ch');
                    return;
                }

                showLoading();
                hideError();
                hideResults();

                try {
                    const response = await fetch('/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ text: text })
                    });

                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.result);
                    } else {
                        showError(data.error || 'C√≥ l·ªói x·∫£y ra khi ph√¢n t√≠ch vƒÉn b·∫£n');
                    }
                } catch (error) {
                    showError('L·ªói k·∫øt n·ªëi: ' + error.message);
                } finally {
                    hideLoading();
                }
            }

            function displayResults(result) {
                // Hi·ªÉn th·ªã th√¥ng tin ng√¥n ng·ªØ
                displayLanguageInfo(result);
                
                // Hi·ªÉn th·ªã tokens
                displayTokens(result.nltk_analysis.tokens);
                
                // Hi·ªÉn th·ªã POS tags
                displayPOSTags(result.nltk_analysis.pos_tags);
                
                // Hi·ªÉn th·ªã ph√¢n t√≠ch chi ti·∫øt
                if (result.spacy_analysis) {
                    displaySpacyAnalysis(result.spacy_analysis.tokens_with_pos);
                    displayEntities(result.spacy_analysis.entities);
                } else {
                    document.getElementById('spacyAnalysis').innerHTML = 
                        '<p class="warning">Kh√¥ng th·ªÉ ph√¢n t√≠ch chi ti·∫øt vƒÉn b·∫£n n√†y.</p>';
                    document.getElementById('entitiesList').innerHTML = 
                        '<p class="warning">Kh√¥ng t√¨m th·∫•y th·ª±c th·ªÉ ƒë∆∞·ª£c ƒë·∫∑t t√™n.</p>';
                }
                
                showResults();
            }

            function displayLanguageInfo(result) {
                const container = document.getElementById('languageInfo');
                const language = result.language;
                const detectedLang = result.detected_language;
                
                let languageName = '';
                let flag = '';
                let description = '';
                
                if (language === 'vietnamese') {
                    languageName = 'Ti·∫øng Vi·ªát';
                    flag = 'üáªüá≥';
                    description = 'VƒÉn b·∫£n ƒë∆∞·ª£c ph√¢n t√≠ch b·∫±ng th∆∞ vi·ªán ti·∫øng Vi·ªát (pyvi, underthesea)';
                } else {
                    languageName = 'English';
                    flag = 'üá∫üá∏';
                    description = 'VƒÉn b·∫£n ƒë∆∞·ª£c ph√¢n t√≠ch b·∫±ng NLTK v√† spaCy';
                }
                
                container.innerHTML = `
                    <div class="language-detected">
                        <span class="language-flag">${flag}</span>
                        <span class="language-name">${languageName}</span>
                        <span class="language-code">(${detectedLang})</span>
                    </div>
                    <div class="language-description">${description}</div>
                `;
            }

            function displayTokens(tokens) {
                const container = document.getElementById('tokensList');
                container.innerHTML = tokens.map(token => 
                    `<span class="token">${escapeHtml(token)}</span>`
                ).join(' ');
            }

            function displayPOSTags(posTags) {
                const container = document.getElementById('posTags');
                container.innerHTML = posTags.map(([token, pos]) => {
                    // T·∫°o m√¥ t·∫£ chi ti·∫øt cho POS tag
                    const posDescription = getPOSDescription(pos);
                    return `<span class="pos-tag" title="${posDescription}">
                        <span class="token">${escapeHtml(token)}</span>
                        <span class="pos">${pos}</span>
                    </span>`;
                }).join(' ');
            }

            function getPOSDescription(pos) {
                const descriptions = {
                    // Danh t·ª´
                    'N': 'Danh t·ª´ chung (Noun)',
                    'Np': 'Danh t·ª´ ri√™ng (Proper Noun)',
                    'Nu': 'Danh t·ª´ ƒë∆°n v·ªã (Unit Noun)',
                    'Nc': 'Danh t·ª´ ch·ªâ lo·∫°i (Classifier Noun)',
                    
                    // ƒê·ªông t·ª´
                    'V': 'ƒê·ªông t·ª´ (Verb)',
                    'Vb': 'ƒê·ªông t·ª´ b·ªï tr·ª£ (Auxiliary Verb)',
                    'Vv': 'ƒê·ªông t·ª´ v·ªã ng·ªØ (Predicative Verb)',
                    
                    // T√≠nh t·ª´
                    'A': 'T√≠nh t·ª´ (Adjective)',
                    'Ab': 'T√≠nh t·ª´ b·ªï tr·ª£ (Auxiliary Adjective)',
                    
                    // ƒê·∫°i t·ª´
                    'P': 'ƒê·∫°i t·ª´ (Pronoun)',
                    'Pp': 'ƒê·∫°i t·ª´ nh√¢n x∆∞ng (Personal Pronoun)',
                    'Pd': 'ƒê·∫°i t·ª´ ch·ªâ ƒë·ªãnh (Demonstrative Pronoun)',
                    'Pq': 'ƒê·∫°i t·ª´ nghi v·∫•n (Interrogative Pronoun)',
                    
                    // S·ªë t·ª´
                    'M': 'S·ªë t·ª´ (Numeral)',
                    'Mc': 'S·ªë t·ª´ ch·ªâ s·ªë l∆∞·ª£ng (Cardinal Numeral)',
                    'Mo': 'S·ªë t·ª´ th·ª© t·ª± (Ordinal Numeral)',
                    
                    // Ph√≥ t·ª´
                    'R': 'Ph√≥ t·ª´ (Adverb)',
                    'Rg': 'Ph√≥ t·ª´ ch·ªâ m·ª©c ƒë·ªô (Degree Adverb)',
                    'Rr': 'Ph√≥ t·ª´ ch·ªâ th·ªùi gian (Time Adverb)',
                    'Rs': 'Ph√≥ t·ª´ ch·ªâ n∆°i ch·ªën (Place Adverb)',
                    
                    // Gi·ªõi t·ª´
                    'E': 'Gi·ªõi t·ª´ (Preposition)',
                    'Ec': 'Gi·ªõi t·ª´ ch·ªâ n∆°i ch·ªën (Place Preposition)',
                    'Et': 'Gi·ªõi t·ª´ ch·ªâ th·ªùi gian (Time Preposition)',
                    
                    // Li√™n t·ª´
                    'C': 'Li√™n t·ª´ (Conjunction)',
                    'Cc': 'Li√™n t·ª´ k·∫øt h·ª£p (Coordinating Conjunction)',
                    'Cs': 'Li√™n t·ª´ ph·ª• thu·ªôc (Subordinating Conjunction)',
                    
                    // Th√°n t·ª´
                    'I': 'Th√°n t·ª´ (Interjection)',
                    
                    // Tr·ª£ t·ª´
                    'T': 'Tr·ª£ t·ª´ (Particle)',
                    'Td': 'Tr·ª£ t·ª´ ƒë·ªãnh ng·ªØ (Determiner Particle)',
                    'Tg': 'Tr·ª£ t·ª´ ng·ªØ kh√≠ (Modal Particle)',
                    
                    // D·∫•u c√¢u
                    'CH': 'D·∫•u c√¢u (Punctuation)',
                    'CHp': 'D·∫•u ch·∫•m (Period)',
                    'CHc': 'D·∫•u ph·∫©y (Comma)',
                    'CHh': 'D·∫•u h·ªèi (Question Mark)',
                    'CHk': 'D·∫•u ch·∫•m than (Exclamation Mark)',
                    
                    // T·ª´ ngo·∫°i lai
                    'FW': 'T·ª´ ngo·∫°i lai (Foreign Word)',
                    
                    // Kh√°c
                    'X': 'T·ª´ kh√°c (Other)',
                    'Y': 'T·ª´ vi·∫øt t·∫Øt (Abbreviation)',
                    'Z': 'T·ª´ kh√¥ng x√°c ƒë·ªãnh (Unknown)',
                    
                    // POS tags ti·∫øng Anh (NLTK)
                    'NN': 'Danh t·ª´ chung (Noun)',
                    'NNP': 'Danh t·ª´ ri√™ng (Proper Noun)',
                    'NNS': 'Danh t·ª´ s·ªë nhi·ªÅu (Plural Noun)',
                    'VB': 'ƒê·ªông t·ª´ g·ªëc (Base Verb)',
                    'VBD': 'ƒê·ªông t·ª´ qu√° kh·ª© (Past Tense Verb)',
                    'VBG': 'ƒê·ªông t·ª´ hi·ªán t·∫°i ph√¢n t·ª´ (Present Participle)',
                    'VBN': 'ƒê·ªông t·ª´ qu√° kh·ª© ph√¢n t·ª´ (Past Participle)',
                    'VBP': 'ƒê·ªông t·ª´ hi·ªán t·∫°i (Present Tense Verb)',
                    'VBZ': 'ƒê·ªông t·ª´ hi·ªán t·∫°i s·ªë √≠t (3rd Person Singular)',
                    'JJ': 'T√≠nh t·ª´ (Adjective)',
                    'JJR': 'T√≠nh t·ª´ so s√°nh h∆°n (Comparative Adjective)',
                    'JJS': 'T√≠nh t·ª´ so s√°nh nh·∫•t (Superlative Adjective)',
                    'PRP': 'ƒê·∫°i t·ª´ nh√¢n x∆∞ng (Personal Pronoun)',
                    'PRP$': 'ƒê·∫°i t·ª´ s·ªü h·ªØu (Possessive Pronoun)',
                    'DT': 'T·ª´ h·∫°n ƒë·ªãnh (Determiner)',
                    'IN': 'Gi·ªõi t·ª´ (Preposition)',
                    'CC': 'Li√™n t·ª´ k·∫øt h·ª£p (Coordinating Conjunction)',
                    'CD': 'S·ªë t·ª´ (Cardinal Number)',
                    'RB': 'Ph√≥ t·ª´ (Adverb)',
                    'RBR': 'Ph√≥ t·ª´ so s√°nh h∆°n (Comparative Adverb)',
                    'RBS': 'Ph√≥ t·ª´ so s√°nh nh·∫•t (Superlative Adverb)',
                    'MD': 'ƒê·ªông t·ª´ khuy·∫øt thi·∫øu (Modal)',
                    'TO': 'To (Infinitive Marker)',
                    'WDT': 'T·ª´ h·∫°n ƒë·ªãnh nghi v·∫•n (Wh-determiner)',
                    'WP': 'ƒê·∫°i t·ª´ nghi v·∫•n (Wh-pronoun)',
                    'WP$': 'ƒê·∫°i t·ª´ s·ªü h·ªØu nghi v·∫•n (Possessive Wh-pronoun)',
                    'WRB': 'Ph√≥ t·ª´ nghi v·∫•n (Wh-adverb)',
                    'EX': 'There (Existential there)',
                    'FW': 'T·ª´ ngo·∫°i lai (Foreign Word)',
                    'LS': 'K√Ω hi·ªáu danh s√°ch (List Marker)',
                    'POS': 'S·ªü h·ªØu (Possessive Ending)',
                    'RP': 'Ti·ªÉu t·ª´ (Particle)',
                    'SYM': 'K√Ω hi·ªáu (Symbol)',
                    'UH': 'Th√°n t·ª´ (Interjection)'
                };
                return descriptions[pos] || `${pos} (Kh√¥ng x√°c ƒë·ªãnh)`;
            }

            function displaySpacyAnalysis(tokensWithPos) {
                const container = document.getElementById('spacyAnalysis');
                container.innerHTML = `
                    <div class="spacy-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Token</th>
                                    <th>POS</th>
                                    <th>Tag</th>
                                    <th>Lemma</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tokensWithPos.map(token => {
                                    const posDescription = getPOSDescription(token.pos);
                                    const tagDescription = getPOSDescription(token.tag);
                                    return `
                                    <tr>
                                        <td>${escapeHtml(token.token)}</td>
                                        <td><span class="pos-badge" title="${posDescription}">${token.pos}</span></td>
                                        <td><span class="tag-badge" title="${tagDescription}">${token.tag}</span></td>
                                        <td>${escapeHtml(token.lemma)}</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function displayEntities(entities) {
                const container = document.getElementById('entitiesList');
                
                if (entities.length === 0) {
                    container.innerHTML = '<p class="no-entities">Kh√¥ng t√¨m th·∫•y th·ª±c th·ªÉ ƒë∆∞·ª£c ƒë·∫∑t t√™n n√†o.</p>';
                    return;
                }

                container.innerHTML = entities.map(entity => `
                    <div class="entity-item">
                        <span class="entity-text">${escapeHtml(entity.text)}</span>
                        <span class="entity-label ${entity.label.toLowerCase()}">${entity.label}</span>
                        <span class="entity-description">${entity.description}</span>
                    </div>
                `).join('');
            }

            function showLoading() {
                loadingIndicator.classList.remove('hidden');
            }

            function hideLoading() {
                loadingIndicator.classList.add('hidden');
            }

            function showResults() {
                results.classList.remove('hidden');
            }

            function hideResults() {
                results.classList.add('hidden');
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
            }

            function hideError() {
                errorMessage.classList.add('hidden');
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        });
    </script>
</body>
</html>
