<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CÃ´ng cá»¥ PhÃ¢n tÃ­ch VÄƒn báº£n NLP</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-brain"></i> CÃ´ng cá»¥ PhÃ¢n tÃ­ch VÄƒn báº£n NLP</h1>
            <p>PhÃ¢n tÃ­ch vÄƒn báº£n vá»›i Tokenization, POS Tagging vÃ  Named Entity Recognition</p>
            <p class="language-support"><i class="fas fa-globe"></i> Há»— trá»£: Tiáº¿ng Viá»‡t ğŸ‡»ğŸ‡³ | English ğŸ‡ºğŸ‡¸</p>
        </header>

        <main class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="textInput">Nháº­p vÄƒn báº£n cáº§n phÃ¢n tÃ­ch:</label>
                    <textarea 
                        id="textInput" 
                        placeholder="Nháº­p vÄƒn báº£n tiáº¿ng Viá»‡t hoáº·c tiáº¿ng Anh cá»§a báº¡n á»Ÿ Ä‘Ã¢y...&#10;&#10;VÃ­ dá»¥ tiáº¿ng Viá»‡t: CÃ´ng ty Apple Inc. cÃ³ trá»¥ sá»Ÿ táº¡i Cupertino, California. Tim Cook lÃ  CEO cá»§a cÃ´ng ty.&#10;VÃ­ dá»¥ tiáº¿ng Anh: Apple Inc. is located in Cupertino, California. Tim Cook is the CEO."
                        rows="6"
                    ></textarea>
                </div>
                <button id="analyzeBtn" class="analyze-btn">
                    <i class="fas fa-search"></i> PhÃ¢n tÃ­ch vÄƒn báº£n
                </button>
            </div>

            <div id="loadingIndicator" class="loading hidden">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Äang phÃ¢n tÃ­ch vÄƒn báº£n...</span>
            </div>

            <div id="results" class="results hidden">
                <div class="result-section language-info">
                    <h2><i class="fas fa-language"></i> ThÃ´ng tin NgÃ´n ngá»¯</h2>
                    <div id="languageInfo" class="language-info-content"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-list"></i> Danh sÃ¡ch Token</h2>
                    <div id="tokensList" class="token-list"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-tags"></i> POS Tags</h2>
                    <div id="posTags" class="pos-tags"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-code"></i> PhÃ¢n tÃ­ch Chi tiáº¿t</h2>
                    <div id="spacyAnalysis" class="spacy-analysis"></div>
                </div>

                <div class="result-section">
                    <h2><i class="fas fa-map-marker-alt"></i> Named Entity Recognition</h2>
                    <div id="entitiesList" class="entities-list"></div>
                </div>
            </div>

            <div id="errorMessage" class="error-message hidden">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText"></span>
            </div>
        </main>

        <footer class="footer">
            <p>ÄÆ°á»£c xÃ¢y dá»±ng vá»›i Flask, NLTK vÃ  spaCy</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const textInput = document.getElementById('textInput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const results = document.getElementById('results');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');

            analyzeBtn.addEventListener('click', analyzeText);

            textInput.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    analyzeText();
                }
            });

            async function analyzeText() {
                const text = textInput.value.trim();
                
                if (!text) {
                    showError('Vui lÃ²ng nháº­p vÄƒn báº£n Ä‘á»ƒ phÃ¢n tÃ­ch');
                    return;
                }

                showLoading();
                hideError();
                hideResults();

                try {
                    const response = await fetch('/analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ text: text })
                    });

                    const data = await response.json();

                    if (data.success) {
                        displayResults(data.result);
                    } else {
                        showError(data.error || 'CÃ³ lá»—i xáº£y ra khi phÃ¢n tÃ­ch vÄƒn báº£n');
                    }
                } catch (error) {
                    showError('Lá»—i káº¿t ná»‘i: ' + error.message);
                } finally {
                    hideLoading();
                }
            }

            function displayResults(result) {
                // Hiá»ƒn thá»‹ thÃ´ng tin ngÃ´n ngá»¯
                displayLanguageInfo(result);
                
                // Hiá»ƒn thá»‹ tokens
                displayTokens(result.nltk_analysis.tokens);
                
                // Hiá»ƒn thá»‹ POS tags
                displayPOSTags(result.nltk_analysis.pos_tags);
                
                // Hiá»ƒn thá»‹ phÃ¢n tÃ­ch chi tiáº¿t
                if (result.spacy_analysis) {
                    displaySpacyAnalysis(result.spacy_analysis.tokens_with_pos);
                    displayEntities(result.spacy_analysis.entities);
                } else {
                    document.getElementById('spacyAnalysis').innerHTML = 
                        '<p class="warning">KhÃ´ng thá»ƒ phÃ¢n tÃ­ch chi tiáº¿t vÄƒn báº£n nÃ y.</p>';
                    document.getElementById('entitiesList').innerHTML = 
                        '<p class="warning">KhÃ´ng tÃ¬m tháº¥y thá»±c thá»ƒ Ä‘Æ°á»£c Ä‘áº·t tÃªn.</p>';
                }
                
                showResults();
            }

            function displayLanguageInfo(result) {
                const container = document.getElementById('languageInfo');
                const language = result.language;
                const detectedLang = result.detected_language;
                
                let languageName = '';
                let flag = '';
                let description = '';
                
                if (language === 'vietnamese') {
                    languageName = 'Tiáº¿ng Viá»‡t';
                    flag = 'ğŸ‡»ğŸ‡³';
                    description = 'VÄƒn báº£n Ä‘Æ°á»£c phÃ¢n tÃ­ch báº±ng thÆ° viá»‡n tiáº¿ng Viá»‡t (pyvi, underthesea)';
                } else {
                    languageName = 'English';
                    flag = 'ğŸ‡ºğŸ‡¸';
                    description = 'VÄƒn báº£n Ä‘Æ°á»£c phÃ¢n tÃ­ch báº±ng NLTK vÃ  spaCy';
                }
                
                container.innerHTML = `
                    <div class="language-detected">
                        <span class="language-flag">${flag}</span>
                        <span class="language-name">${languageName}</span>
                        <span class="language-code">(${detectedLang})</span>
                    </div>
                    <div class="language-description">${description}</div>
                `;
            }

            function displayTokens(tokens) {
                const container = document.getElementById('tokensList');
                container.innerHTML = tokens.map(token => 
                    `<span class="token">${escapeHtml(token)}</span>`
                ).join(' ');
            }

            function displayPOSTags(posTags) {
                const container = document.getElementById('posTags');
                container.innerHTML = posTags.map(([token, pos]) => {
                    // Táº¡o mÃ´ táº£ chi tiáº¿t cho POS tag
                    const posDescription = getPOSDescription(pos);
                    return `<span class="pos-tag" title="${posDescription}">
                        <span class="token">${escapeHtml(token)}</span>
                        <span class="pos">${pos}</span>
                    </span>`;
                }).join(' ');
            }

            function getPOSDescription(pos) {
                const descriptions = {
                    // Danh tá»«
                    'N': 'Danh tá»« chung (Noun)',
                    'Np': 'Danh tá»« riÃªng (Proper Noun)',
                    'Nu': 'Danh tá»« Ä‘Æ¡n vá»‹ (Unit Noun)',
                    'Nc': 'Danh tá»« chá»‰ loáº¡i (Classifier Noun)',
                    
                    // Äá»™ng tá»«
                    'V': 'Äá»™ng tá»« (Verb)',
                    'Vb': 'Äá»™ng tá»« bá»• trá»£ (Auxiliary Verb)',
                    'Vv': 'Äá»™ng tá»« vá»‹ ngá»¯ (Predicative Verb)',
                    
                    // TÃ­nh tá»«
                    'A': 'TÃ­nh tá»« (Adjective)',
                    'Ab': 'TÃ­nh tá»« bá»• trá»£ (Auxiliary Adjective)',
                    
                    // Äáº¡i tá»«
                    'P': 'Äáº¡i tá»« (Pronoun)',
                    'Pp': 'Äáº¡i tá»« nhÃ¢n xÆ°ng (Personal Pronoun)',
                    'Pd': 'Äáº¡i tá»« chá»‰ Ä‘á»‹nh (Demonstrative Pronoun)',
                    'Pq': 'Äáº¡i tá»« nghi váº¥n (Interrogative Pronoun)',
                    
                    // Sá»‘ tá»«
                    'M': 'Sá»‘ tá»« (Numeral)',
                    'Mc': 'Sá»‘ tá»« chá»‰ sá»‘ lÆ°á»£ng (Cardinal Numeral)',
                    'Mo': 'Sá»‘ tá»« thá»© tá»± (Ordinal Numeral)',
                    
                    // PhÃ³ tá»«
                    'R': 'PhÃ³ tá»« (Adverb)',
                    'Rg': 'PhÃ³ tá»« chá»‰ má»©c Ä‘á»™ (Degree Adverb)',
                    'Rr': 'PhÃ³ tá»« chá»‰ thá»i gian (Time Adverb)',
                    'Rs': 'PhÃ³ tá»« chá»‰ nÆ¡i chá»‘n (Place Adverb)',
                    
                    // Giá»›i tá»«
                    'E': 'Giá»›i tá»« (Preposition)',
                    'Ec': 'Giá»›i tá»« chá»‰ nÆ¡i chá»‘n (Place Preposition)',
                    'Et': 'Giá»›i tá»« chá»‰ thá»i gian (Time Preposition)',
                    
                    // LiÃªn tá»«
                    'C': 'LiÃªn tá»« (Conjunction)',
                    'Cc': 'LiÃªn tá»« káº¿t há»£p (Coordinating Conjunction)',
                    'Cs': 'LiÃªn tá»« phá»¥ thuá»™c (Subordinating Conjunction)',
                    
                    // ThÃ¡n tá»«
                    'I': 'ThÃ¡n tá»« (Interjection)',
                    
                    // Trá»£ tá»«
                    'T': 'Trá»£ tá»« (Particle)',
                    'Td': 'Trá»£ tá»« Ä‘á»‹nh ngá»¯ (Determiner Particle)',
                    'Tg': 'Trá»£ tá»« ngá»¯ khÃ­ (Modal Particle)',
                    
                    // Dáº¥u cÃ¢u
                    'CH': 'Dáº¥u cÃ¢u (Punctuation)',
                    'CHp': 'Dáº¥u cháº¥m (Period)',
                    'CHc': 'Dáº¥u pháº©y (Comma)',
                    'CHh': 'Dáº¥u há»i (Question Mark)',
                    'CHk': 'Dáº¥u cháº¥m than (Exclamation Mark)',
                    
                    // Tá»« ngoáº¡i lai
                    'FW': 'Tá»« ngoáº¡i lai (Foreign Word)',
                    
                    // KhÃ¡c
                    'X': 'Tá»« khÃ¡c (Other)',
                    'Y': 'Tá»« viáº¿t táº¯t (Abbreviation)',
                    'Z': 'Tá»« khÃ´ng xÃ¡c Ä‘á»‹nh (Unknown)',
                    
                    // POS tags tiáº¿ng Anh (NLTK)
                    'NN': 'Danh tá»« chung (Noun)',
                    'NNP': 'Danh tá»« riÃªng (Proper Noun)',
                    'NNS': 'Danh tá»« sá»‘ nhiá»u (Plural Noun)',
                    'VB': 'Äá»™ng tá»« gá»‘c (Base Verb)',
                    'VBD': 'Äá»™ng tá»« quÃ¡ khá»© (Past Tense Verb)',
                    'VBG': 'Äá»™ng tá»« hiá»‡n táº¡i phÃ¢n tá»« (Present Participle)',
                    'VBN': 'Äá»™ng tá»« quÃ¡ khá»© phÃ¢n tá»« (Past Participle)',
                    'VBP': 'Äá»™ng tá»« hiá»‡n táº¡i (Present Tense Verb)',
                    'VBZ': 'Äá»™ng tá»« hiá»‡n táº¡i sá»‘ Ã­t (3rd Person Singular)',
                    'JJ': 'TÃ­nh tá»« (Adjective)',
                    'JJR': 'TÃ­nh tá»« so sÃ¡nh hÆ¡n (Comparative Adjective)',
                    'JJS': 'TÃ­nh tá»« so sÃ¡nh nháº¥t (Superlative Adjective)',
                    'PRP': 'Äáº¡i tá»« nhÃ¢n xÆ°ng (Personal Pronoun)',
                    'PRP$': 'Äáº¡i tá»« sá»Ÿ há»¯u (Possessive Pronoun)',
                    'DT': 'Tá»« háº¡n Ä‘á»‹nh (Determiner)',
                    'IN': 'Giá»›i tá»« (Preposition)',
                    'CC': 'LiÃªn tá»« káº¿t há»£p (Coordinating Conjunction)',
                    'CD': 'Sá»‘ tá»« (Cardinal Number)',
                    'RB': 'PhÃ³ tá»« (Adverb)',
                    'RBR': 'PhÃ³ tá»« so sÃ¡nh hÆ¡n (Comparative Adverb)',
                    'RBS': 'PhÃ³ tá»« so sÃ¡nh nháº¥t (Superlative Adverb)',
                    'MD': 'Äá»™ng tá»« khuyáº¿t thiáº¿u (Modal)',
                    'TO': 'To (Infinitive Marker)',
                    'WDT': 'Tá»« háº¡n Ä‘á»‹nh nghi váº¥n (Wh-determiner)',
                    'WP': 'Äáº¡i tá»« nghi váº¥n (Wh-pronoun)',
                    'WP$': 'Äáº¡i tá»« sá»Ÿ há»¯u nghi váº¥n (Possessive Wh-pronoun)',
                    'WRB': 'PhÃ³ tá»« nghi váº¥n (Wh-adverb)',
                    'EX': 'There (Existential there)',
                    'FW': 'Tá»« ngoáº¡i lai (Foreign Word)',
                    'LS': 'KÃ½ hiá»‡u danh sÃ¡ch (List Marker)',
                    'POS': 'Sá»Ÿ há»¯u (Possessive Ending)',
                    'RP': 'Tiá»ƒu tá»« (Particle)',
                    'SYM': 'KÃ½ hiá»‡u (Symbol)',
                    'UH': 'ThÃ¡n tá»« (Interjection)'
                };
                return descriptions[pos] || `${pos} (KhÃ´ng xÃ¡c Ä‘á»‹nh)`;
            }

            function displaySpacyAnalysis(tokensWithPos) {
                const container = document.getElementById('spacyAnalysis');
                container.innerHTML = `
                    <div class="spacy-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Token</th>
                                    <th>POS</th>
                                    <th>Tag</th>
                                    <th>Lemma</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tokensWithPos.map(token => {
                                    const posDescription = getPOSDescription(token.pos);
                                    const tagDescription = getPOSDescription(token.tag);
                                    return `
                                    <tr>
                                        <td>${escapeHtml(token.token)}</td>
                                        <td><span class="pos-badge" title="${posDescription}">${token.pos}</span></td>
                                        <td><span class="tag-badge" title="${tagDescription}">${token.tag}</span></td>
                                        <td>${escapeHtml(token.lemma)}</td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            function displayEntities(entities) {
                const container = document.getElementById('entitiesList');
                
                if (entities.length === 0) {
                    container.innerHTML = '<p class="no-entities">KhÃ´ng tÃ¬m tháº¥y thá»±c thá»ƒ Ä‘Æ°á»£c Ä‘áº·t tÃªn nÃ o.</p>';
                    return;
                }

                container.innerHTML = entities.map(entity => `
                    <div class="entity-item">
                        <span class="entity-text">${escapeHtml(entity.text)}</span>
                        <span class="entity-label ${entity.label.toLowerCase()}">${entity.label}</span>
                        <span class="entity-description">${entity.description}</span>
                    </div>
                `).join('');
            }

            function showLoading() {
                loadingIndicator.classList.remove('hidden');
            }

            function hideLoading() {
                loadingIndicator.classList.add('hidden');
            }

            function showResults() {
                results.classList.remove('hidden');
            }

            function hideResults() {
                results.classList.add('hidden');
            }

            function showError(message) {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
            }

            function hideError() {
                errorMessage.classList.add('hidden');
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        });
    </script>
</body>
</html>
